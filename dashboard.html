<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Panel de AdministraciÃ³n - Registros</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
Â  <script src="config.js"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  background-color: #f8f9fa;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 1200px;
Â  Â  Â  margin-top: 40px;
Â  Â  }
Â  Â  h1 { /* AÃ±adido un estilo para h1 para que sea mÃ¡s consistente */
Â  Â  Â  color: #0056b3;
Â  Â  Â  margin-bottom: 30px;
Â  Â  }
Â  Â  h2 {
Â  Â  Â  color: #333;
Â  Â  Â  margin-top: 30px; /* Espacio superior para separar las secciones de tablas */
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  margin-bottom: 40px;
Â  Â  Â  font-size: 0.85em; /* Ligeramente mÃ¡s pequeÃ±o para tablas con muchas columnas */
Â  Â  }
Â  Â  th, td {
Â  Â  Â  padding: 8px; /* Ajustado a 8px para tablas con mÃ¡s columnas */
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  text-align: left;
Â  Â  Â  vertical-align: top; /* Alinea el contenido en la parte superior */
Â  Â  Â  word-wrap: break-word; /* Permite que las palabras largas se rompan y pasen a la siguiente lÃ­nea */
Â  Â  }
Â  Â  th {
Â  Â  Â  background-color: #e9ecef;
Â  Â  Â  position: sticky; /* Hace que los encabezados de la tabla sean pegajosos */
Â  Â  Â  top: 0; /* Se pegan en la parte superior al hacer scroll */
Â  Â  Â  z-index: 1; /* Asegura que estÃ©n por encima del contenido de la tabla */
Â  Â  }
Â  Â  .logout-btn {
Â  Â  Â  float: right;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  /* Estilos para los mensajes personalizados */
Â  Â  .custom-alert {
Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  border: 1px solid transparent;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  display: none; /* Oculto por defecto */
Â  Â  }
Â  Â  .custom-alert.success {
Â  Â  Â  Â  color: #155724;
Â  Â  Â  Â  background-color: #d4edda;
Â  Â  Â  Â  border-color: #c3e6cb;
Â  Â  }
Â  Â  .custom-alert.error {
Â  Â  Â  Â  color: #721c24;
Â  Â  Â  Â  background-color: #f8d7da;
Â  Â  Â  Â  border-color: #f5c6cb;
Â  Â  }
Â  </style>
</head>
<body>

<div class="container">
Â  <h1>ðŸ“Š Panel de AdministraciÃ³n - Registros</h1>
Â  <button class="btn btn-danger logout-btn" onclick="logout()">Cerrar SesiÃ³n</button>

Â  Â  <div id="dashboardSuccessMessage" class="custom-alert success"></div>
Â  <div id="dashboardErrorMessage" class="custom-alert error"></div>

Â  Â  <h2>Datos AcadÃ©micos</h2>
Â  <div class="table-responsive"> Â  Â  <table id="academicosTable" class="table table-striped table-bordered">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>ID</th>
Â  Â  Â  Â  Â  <th>Fecha MatrÃ­cula</th>
Â  Â  Â  Â  Â  <th>Ciudad de Residencia</th> Â  Â  Â  Â  Â  <th>Municipio AcadÃ©mico</th> Â  Â  Â  Â  Â  <th>CÃ³digo Ãšnico</th>
Â  Â  Â  Â  Â  <th>CÃ³digo Centro</th>
Â  Â  Â  Â  Â  <th>Nombre del Centro</th>
Â  Â  Â  Â  Â  <th>Nivel Educativo</th>
Â  Â  Â  Â  Â  <th>Modalidad</th>
Â  Â  Â  Â  Â  <th>Turno</th>
Â  Â  Â  Â  Â  <th>Grado</th>
Â  Â  Â  Â  Â  <th>SecciÃ³n</th>
Â  Â  Â  Â  Â  <th>Repitente</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  Â  <h2>Datos del Estudiante</h2>
Â  <div class="table-responsive">
Â  Â  <table id="estudiantesTable" class="table table-striped table-bordered">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>ID</th>
Â  Â  Â  Â  Â  <th>Nombre Completo</th>
Â  Â  Â  Â  Â  <th>TelÃ©fono</th>
Â  Â  Â  Â  Â  <th>DirecciÃ³n</th>
Â  Â  Â  Â  Â  <th>Fecha de Nacimiento</th>
Â  Â  Â  Â  Â  <th>GÃ©nero</th>
Â  Â  Â  Â  Â  <th>Peso (kg)</th>
Â  Â  Â  Â  Â  <th>Talla (cm)</th>
Â  Â  Â  Â  Â  <th>Nacionalidad</th>
Â  Â  Â  Â  Â  <th>PaÃ­s de Nacimiento</th>
Â  Â  Â  Â  Â  <th>Residencia Depto.</th>
Â  Â  Â  Â  Â  <th>Residencia Municipio</th>
Â  Â  Â  Â  Â  <th>Lengua Materna</th>
Â  Â  Â  Â  Â  <th>Discapacidad</th>
Â  Â  Â  Â  Â  <th>Territorio IndÃ­gena</th>
Â  Â  Â  Â  Â  <th>Habita en Territorio IndÃ­gena</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>

Â  Â  <h2>Datos de Padres o Tutor</h2>
Â  <div class="table-responsive">
Â  Â  <table id="padresTable" class="table table-striped table-bordered">
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th>ID</th>
Â  Â  Â  Â  Â  <th>Madre</th>
Â  Â  Â  Â  Â  <th>Tipo ID Madre</th> Â  Â  Â  Â  Â  <th>CÃ©dula Madre</th>
Â  Â  Â  Â  Â  <th>TelÃ©fono Madre</th>
Â  Â  Â  Â  Â  <th>Padre</th>
Â  Â  Â  Â  Â  <th>Tipo ID Padre</th> Â  Â  Â  Â  Â  <th>CÃ©dula Padre</th>
Â  Â  Â  Â  Â  <th>TelÃ©fono Padre</th>
Â  Â  Â  Â  Â  <th>Tutor</th>
Â  Â  Â  Â  Â  <th>Tipo ID Tutor</th> Â  Â  Â  Â  Â  <th>CÃ©dula Tutor</th>
Â  Â  Â  Â  Â  <th>TelÃ©fono Tutor</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody></tbody>
Â  Â  </table>
Â  </div>
</div>

<script>
Â  Â  
Â  Â  Â  const BACKEND_URL = window.BACKEND_API_URL; 
Â  Â  
Â  Â  function showDashboardAlert(message, type = 'success', duration = 5000) {
Â  Â  Â  Â  const successDiv = document.getElementById('dashboardSuccessMessage');
Â  Â  Â  Â  const errorDiv = document.getElementById('dashboardErrorMessage');

Â  Â  Â  Â  successDiv.style.display = 'none';
Â  Â  Â  Â  errorDiv.style.display = 'none';

Â  Â  Â  Â  if (type === 'success') {
Â  Â  Â  Â  Â  Â  successDiv.textContent = message;
Â  Â  Â  Â  Â  Â  successDiv.style.display = 'block';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  errorDiv.textContent = message;
Â  Â  Â  Â  Â  Â  errorDiv.style.display = 'block';
Â  Â  Â  Â  }

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  successDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  errorDiv.style.display = 'none';
Â  Â  Â  Â  }, duration);
Â  Â  }

Â  Â  document.addEventListener('DOMContentLoaded', async () => {

Â  Â  Â  Â  const isLoggedIn = localStorage.getItem('isLoggedIn');
Â  Â  Â  Â  if (!isLoggedIn || isLoggedIn !== 'true') {
Â  Â  Â  Â  Â  Â  showDashboardAlert('Acceso denegado. Por favor inicia sesiÃ³n.', 'error');
Â  Â  Â  Â  Â  Â  setTimeout(() => { 
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'login.html';
Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const response = await fetch(`${BACKEND_URL}/api/registros`);
Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Error ${response.status}: ${response.statusText || 'No autorizado o error en la peticiÃ³n.'}`);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  // Tabla de Datos AcadÃ©micos
Â  Â  Â  Â  Â  Â  populateTable('academicosTable', data.academicos, [
Â  Â  Â  Â  Â  Â  Â  'id', 'fechaMatricula', 'departamento', 'municipio', 'codigoUnico', // AÃ±adido 'municipio'
Â  Â  Â  Â  Â  Â  Â  'codigoCentro', 'nombreCentro', 'nivelEducativo',
Â  Â  Â  Â  Â  Â  Â  'modalidad', 'turno', 'grado', 'seccion', 'repitente'
Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  // Tabla de Estudiantes
Â  Â  Â  Â  Â  Â  populateTable('estudiantesTable', data.estudiantes, [
Â  Â  Â  Â  Â  Â  Â  'id', 'nombreCompleto', 'telefono', 'direccion',
Â  Â  Â  Â  Â  Â  Â  'fechaNacimiento', 'genero', 'peso', 'talla',
Â  Â  Â  Â  Â  Â  Â  'nacionalidad', 'paisNacimiento',
Â  Â  Â  Â  Â  Â  Â  'residenciaDepartamento', 'residenciaMunicipio',
Â  Â  Â  Â  Â  Â  Â  'lenguaMaterna', 'discapacidad',
Â  Â  Â  Â  Â  Â  Â  'territorioIndigena', 'habitaIndigena'
Â  Â  Â  Â  Â  Â  ], row => ({
Â  Â  Â  Â  Â  Â  Â  id: row.id,
Â  Â  Â  Â  Â  Â  Â  nombreCompleto: `${row.primerNombre || ''} ${row.segundoNombre || ''} ${row.primerApellido || ''} ${row.segundoApellido || ''}`.trim(),
Â  Â  Â  Â  Â  Â  Â  telefono: row.telefono || 'N/A',
Â  Â  Â  Â  Â  Â  Â  direccion: row.direccion || 'N/A',
Â  Â  Â  Â  Â  Â  Â  fechaNacimiento: row.fechaNacimiento ? new Date(row.fechaNacimiento).toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' }) : 'N/A',
Â  Â  Â  Â  Â  Â  Â  genero: row.genero || 'N/A',
Â  Â  Â  Â  Â  Â  Â  peso: row.peso ? parseFloat(row.peso).toFixed(2) : 'N/A',
Â  Â  Â  Â  Â  Â  Â  talla: row.talla ? parseFloat(row.talla).toFixed(2) : 'N/A',
Â  Â  Â  Â  Â  Â  Â  nacionalidad: row.nacionalidad || 'N/A',
Â  Â  Â  Â  Â  Â  Â  paisNacimiento: row.paisNacimiento || 'N/A',
Â  Â  Â  Â  Â  Â  Â  residenciaDepartamento: row.residenciaDepartamento || 'N/A',
Â  Â  Â  Â  Â  Â  Â  residenciaMunicipio: row.residenciaMunicipio || 'N/A',
Â  Â  Â  Â  Â  Â  Â  lenguaMaterna: row.lenguaMaterna || 'N/A',
Â  Â  Â  Â  Â  Â  Â  discapacidad: row.discapacidad || 'N/A',
Â  Â  Â  Â  Â  Â  Â  territorioIndigena: row.territorioIndigena || 'N/A',
Â  Â  Â  Â  Â  Â  Â  habitaIndigena: row.habitaIndigena || 'N/A'
Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  // Tabla de Padres o Tutor
Â  Â  Â  Â  Â  Â  populateTable('padresTable', data.padres, [
Â  Â  Â  Â  Â  Â  Â  'id', 
Â  Â  Â  Â  Â  Â  Â  'nombreCompletoMadre', 'tipoIdentificacionMadre', 'cedulaMadre', 'telefonoMadre',
Â  Â  Â  Â  Â  Â  Â  'nombreCompletoPadre', 'tipoIdentificacionPadre', 'cedulaPadre', 'telefonoPadre',
Â  Â  Â  Â  Â  Â  Â  'nombreCompletoTutor', 'tipoIdentificacionTutor', 'cedulaTutor', 'telefonoTutor'
Â  Â  Â  Â  Â  Â  ], row => ({
Â  Â  Â  Â  Â  Â  Â  id: row.id,
Â  Â  Â  Â  Â  Â  Â  nombreCompletoMadre: `${row.primerNombreMadre || ''} ${row.segundoNombreMadre || ''} ${row.primerApellidoMadre || ''} ${row.segundoApellidoMadre || ''}`.trim() || 'N/A',
Â  Â  Â  Â  Â  Â  Â  tipoIdentificacionMadre: row.tipoIdentificacionMadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  cedulaMadre: row.cedulaMadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  telefonoMadre: row.telefonoMadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  nombreCompletoPadre: `${row.primerNombrePadre || ''} ${row.segundoNombrePadre || ''} ${row.primerApellidoPadre || ''} ${row.segundoApellidoPadre || ''}`.trim() || 'N/A',
Â  Â  Â  Â  Â  Â  Â  tipoIdentificacionPadre: row.tipoIdentificacionPadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  cedulaPadre: row.cedulaPadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  telefonoPadre: row.telefonoPadre || 'N/A',
Â  Â  Â  Â  Â  Â  Â  nombreCompletoTutor: `${row.primerNombreTutor || ''} ${row.segundoNombreTutor || ''} ${row.primerApellidoTutor || ''} ${row.segundoApellidoTutor || ''}`.trim() || 'N/A',
Â  Â  Â  Â  Â  Â  Â  tipoIdentificacionTutor: row.tipoIdentificacionTutor || 'N/A',
Â  Â  Â  Â  Â  Â  Â  cedulaTutor: row.cedulaTutor || 'N/A',
Â  Â  Â  Â  Â  Â  Â  telefonoTutor: row.telefonoTutor || 'N/A'
Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error('âŒ Error al cargar los registros:', error);
Â  Â  Â  Â  Â  Â  showDashboardAlert(`Hubo un problema cargando los registros: ${error.message}.`, 'error');
Â  Â  Â  Â  Â  Â  setTimeout(() => { 
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'login.html';
Â  Â  Â  Â  Â  Â  }, 2000);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  function logout() {
Â  Â  Â  Â  localStorage.removeItem('isLoggedIn');
Â  Â  Â  Â  window.location.href = 'index.html';
Â  Â  }

Â  Â  function populateTable(tableId, records, columns, transformFn) {
Â  Â  Â  Â  const tbody = document.querySelector(`#${tableId} tbody`);
Â  Â  Â  Â  tbody.innerHTML = '';

Â  Â  Â  Â  records.forEach(record => {
Â  Â  Â  Â  Â  Â  const row = document.createElement('tr');

Â  Â  Â  Â  Â  Â  if (transformFn) {
Â  Â  Â  Â  Â  Â  Â  Â  const transformed = transformFn(record);
Â  Â  Â  Â  Â  Â  Â  Â  columns.forEach(col => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cell = document.createElement('td');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cell.textContent = transformed[col];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.appendChild(cell);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  columns.forEach(col => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cell = document.createElement('td');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cell.textContent = record[col] || 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.appendChild(cell);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  tbody.appendChild(row);
Â  Â  Â  Â  });
Â  Â  }
</script>

</body>
</html>